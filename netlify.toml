[build]
  command = "npm run build"
  publish = ".next"

[[plugins]]
  package = "@netlify/plugin-nextjs"

[build.environment]
  NODE_VERSION = "18"
  # Enable build caching to speed up builds
  NETLIFY_NEXT_PLUGIN_SKIP = "false"
  # Use Netlify's build cache
  NPM_FLAGS = "--prefer-offline --no-audit"

# Disable preview deploys for branches (only deploy main/production)
# This saves credits by not building every branch/PR
[context.branch-deploy]
  command = "# Skip branch deploys"

[context.deploy-preview]
  command = "# Skip preview deploys"

[context.production]
  command = "npm run build"

# Optimize build performance
[build.processing]
  skip_processing = false
  css = { bundle = true, minify = true }
  js = { bundle = true, minify = true }
  html = { pretty_urls = true }
  images = { compress = true }

# Cache node_modules between builds
[[plugins]]
  package = "@netlify/plugin-cache"
  [plugins.inputs]
    paths = [
      "node_modules/.cache",
      ".next/cache"
    ]
